// api/stress.js
export default async function handler(req, res) {
      if (req.method !== "POST") {
            return res.status(405).json({ error: "Method not allowed" });
      }

        try {
                const {
                          propertyType,
                                purchasePrice,
                                      downPayment,
                                            interestRate,
                                                  rentalIncome,
                                                        operatingExpenses,
                } = req.body;

                    // --- BASIC VALIDATION ---
                        if (!purchasePrice || !downPayment || !interestRate) {
                                  return res.status(400).json({
                                            error: "Missing required fields: purchasePrice, downPayment, or interestRate",
                                  });
                        }

                            // --- STRESS TEST CALCULATIONS ---
                                const loanAmount = purchasePrice - downPayment;
                                    const monthlyRate = interestRate / 100 / 12;
                                        const loanYears = 30;
                                            const n = loanYears * 12;

                                                const monthlyPayment =
                                                      (loanAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -n));

                                                          const netIncome = rentalIncome - operatingExpenses;
                                                              const cashFlow = netIncome - monthlyPayment;
                                                                  const roi =
                                                                        ((netIncome * 12) / (downPayment + operatingExpenses * 6)) * 100;

                                                                            // --- STRESS TEST SCORING ---
                                                                                let risk = "Low";
                                                                                    if (cashFlow < 0) risk = "High";
                                                                                        else if (roi < 6) risk = "Medium";

                                                                                            const capitalIndex =
                                                                                                  risk === "High" ? "üö® Fragile" : risk === "Medium" ? "‚ö†Ô∏è Moderate" : "‚úÖ Strong";

                                                                                                      const liquidity =
                                                                                                            operatingExpenses > rentalIncome * 0.6
                                                                                                                    ? "‚ö†Ô∏è Tight Liquidity"
                                                                                                                            : "üíß Healthy Liquidity";

                                                                                                                                const summary = `Your investment shows a ${risk} risk level with ${capitalIndex} capital stability and ${liquidity}.`;

                                                                                                                                    // --- RESPONSE ---
                                                                                                                                        return res.status(200).json({
                                                                                                                                                  message: "Stress test complete",
                                                                                                                                                        risk,
                                                                                                                                                              capitalIndex,
                                                                                                                                                                    liquidity,
                                                                                                                                                                          cashFlow: cashFlow.toFixed(2),
                                                                                                                                                                                roi: roi.toFixed(2) + "%",
                                                                                                                                                                                      summary,
                                                                                                                                        });
        } catch (err) {
                console.error("‚ùå Error in /api/stress:", err);
                    return res.status(500).json({ error: "Internal Server Error" });
        }
}
        }
                                                                                                                                        })
                                  })
                        }
                }
        }
      }
}