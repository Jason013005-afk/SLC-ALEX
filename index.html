<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>SLC-ALEX Property Analyzer</title>
        <link rel="stylesheet" href="styles.css" />
        </head>
        <body>
          <!-- HERO SECTION -->
            <section class="hero">
                <img src="images/slc-logo.png" alt="SLC Logo" class="hero-logo" />
                    <h1>SLC-ALEX Property Analyzer</h1>
                        <p id="backend-status">üü° Checking backend...</p>
                          </section>

                            <!-- NAVIGATION -->
                              <nav class="nav-links">
                                  <a href="index.html" class="active">Home</a>
                                      <a href="service.html">Services</a>
                                          <a href="price.html">Pricing</a>
                                              <a href="contact.html">Contact</a>
                                                  <a href="system.html">System</a>
                                                    </nav>

                                                      <!-- FORM SECTION -->
                                                        <section class="form-section">
                                                            <h2>Enter Property Details</h2>

                                                                <label for="address">Property Address:</label>
                                                                    <input type="text" id="address" placeholder="123 Main St" />

                                                                        <label for="interestRate">Interest Rate (%):</label>
                                                                            <input type="number" id="interestRate" placeholder="6.5" />

                                                                                <button id="analyzeBtn">üîç Analyze Property</button>

                                                                                    <div id="results"></div>
                                                                                      </section>

                                                                                        <!-- FOOTER -->
                                                                                          <footer>‚öôÔ∏è Powered by ALEX Backend</footer>

                                                                                            <!-- SCRIPT -->
                                                                                              <script>
                                                                                                  const backendStatus = document.getElementById("backend-status");
                                                                                                      const analyzeBtn = document.getElementById("analyzeBtn");
                                                                                                          const resultsDiv = document.getElementById("results");

                                                                                                              // üß† Auto-detect the backend dynamically
                                                                                                                  const currentHost = window.location.hostname;
                                                                                                                      const BACKEND_URL = `https://${currentHost.replace(
                                                                                                                            /-\d+\./,
                                                                                                                                  "-40205."
                                                                                                                                      )}`; // replaces current port (like 35227) with backend port (40205)

                                                                                                                                          async function checkBackend() {
                                                                                                                                                try {
                                                                                                                                                        const res = await fetch(BACKEND_URL);
                                                                                                                                                                if (!res.ok) throw new Error("Bad response");
                                                                                                                                                                        backendStatus.textContent = "üü¢ Backend Connected";
                                                                                                                                                                                backendStatus.style.color = "lime";
                                                                                                                                                                                      } catch {
                                                                                                                                                                                              backendStatus.textContent = "üî¥ Backend Connection Failed";
                                                                                                                                                                                                      backendStatus.style.color = "red";
                                                                                                                                                                                                            }
                                                                                                                                                                                                                }

                                                                                                                                                                                                                    async function analyzeProperty() {
                                                                                                                                                                                                                          const address = document.getElementById("address").value.trim();
                                                                                                                                                                                                                                const interestRate = document.getElementById("interestRate").value.trim();

                                                                                                                                                                                                                                      if (!address || !interestRate) {
                                                                                                                                                                                                                                              resultsDiv.innerHTML =
                                                                                                                                                                                                                                                        "<p style='color:yellow;'>‚ö†Ô∏è Please fill all fields.</p>";
                                                                                                                                                                                                                                                                return;
                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                            analyzeBtn.disabled = true;
                                                                                                                                                                                                                                                                                  analyzeBtn.classList.add("loading");
                                                                                                                                                                                                                                                                                        analyzeBtn.textContent = "Analyzing...";

                                                                                                                                                                                                                                                                                              try {
                                                                                                                                                                                                                                                                                                      const res = await fetch(`${BACKEND_URL}/api/stress`, {
                                                                                                                                                                                                                                                                                                                method: "POST",
                                                                                                                                                                                                                                                                                                                          headers: { "Content-Type": "application/json" },
                                                                                                                                                                                                                                                                                                                                    body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                address,
                                                                                                                                                                                                                                                                                                                                                            interestRate: parseFloat(interestRate),
                                                                                                                                                                                                                                                                                                                                                                      }),
                                                                                                                                                                                                                                                                                                                                                                              });

                                                                                                                                                                                                                                                                                                                                                                                      if (!res.ok) throw new Error("Bad response");

                                                                                                                                                                                                                                                                                                                                                                                              const data = await res.json();
                                                                                                                                                                                                                                                                                                                                                                                                      resultsDiv.innerHTML = `
                                                                                                                                                                                                                                                                                                                                                                                                                <div class="result-box">
                                                                                                                                                                                                                                                                                                                                                                                                                            <h3>üìä Analysis Results</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                        <p><b>Address:</b> ${data.address}</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                    <p><b>Estimated Value:</b> $${data.estimatedValue.toLocaleString()}</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p><b>Rent:</b> $${data.rentValue.toLocaleString()}</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p><b>ROI:</b> ${data.roi}</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <p><b>Appreciation:</b> $${data.appreciation.toLocaleString()}</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          `;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (err) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        resultsDiv.innerHTML =
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  "<p style='color:gold;'>‚ö†Ô∏è Could not fetch analysis. Check backend or input.</p>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              analyzeBtn.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    analyzeBtn.classList.remove("loading");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          analyzeBtn.textContent = "üîç Analyze Property";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  checkBackend();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      analyzeBtn.addEventListener("click", analyzeProperty);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </html>